#=====================================================
# VISUALISATION and VERBOSE
#=====================================================

{%- if visualisation -%}
/control/execute                    ./Visualisation.mac
{%- elseif -%}
/vis/disable
{%- endif -%}


/gate/verbose Physic    {% verbose | default(0) %}
/gate/verbose Cuts      {% verbose | default(0) %}
/gate/verbose SD        {% verbose | default(0) %}
/gate/verbose Actions   {% verbose | default(0) %}
/gate/verbose Actor     {% verbose | default(0) %}
/gate/verbose Step      {% verbose | default(0) %}
/gate/verbose Error     {% verbose | default(0) %}
/gate/verbose Warning   {% verbose | default(0) %}
/gate/verbose Output    {% verbose | default(0) %}
/gate/verbose Beam      {% verbose | default(0) %}
/gate/verbose Volume    {% verbose | default(0) %}
/gate/verbose Image     {% verbose | default(0) %}
/gate/verbose Geometry  {% verbose | default(0) %}
/gate/verbose Core      {% verbose | default(0) %}

/run/verbose {% verbose | default(0) %}
/event/verbose {% verbose | default(0) %}
/tracking/verbose {% verbose | default(0) %}


#=====================================================
# GEOMETRY
#=====================================================

/gate/geometry/setMaterialDatabase    ./GateMaterials.db

#=====================================================
#     W O R L D
#=====================================================




#-------------------oooooOOOOO00000OOOOOooooo---------------------#
#                                                                 #
#     D E F I N I T I O N   A N D   D E S C R I T I O N           #
#        O F   Y O U R   D E V I C E                              #
#                                                                 #
#-------------------oooooOOOOO00000OOOOOooooo---------------------#

#=======================================================
#                   G E O M E T R Y
#=======================================================

/control/execute                    ./Geometry.mac
  
#=====================================================
#                  P H Y S I C S
#=====================================================


/gate/physics/addProcess OpticalAbsorption
/gate/physics/addProcess OpticalRayleigh
/gate/physics/addProcess OpticalBoundary
/gate/physics/addProcess OpticalMie
/gate/physics/addProcess OpticalWLS
/gate/physics/addProcess Scintillation


/gate/physics/addProcess PhotoElectric
/gate/physics/processes/PhotoElectric/setModel StandardModel

/gate/physics/addProcess Compton
/gate/physics/processes/Compton/setModel StandardModel

/gate/physics/addProcess RayleighScattering
/gate/physics/processes/RayleighScattering/setModel PenelopeModel

/gate/physics/addProcess ElectronIonisation
/gate/physics/processes/ElectronIonisation/setModel StandardModel e-
/gate/physics/processes/ElectronIonisation/setModel StandardModel e+

/gate/physics/addProcess Bremsstrahlung
/gate/physics/processes/Bremsstrahlung/setModel StandardModel e-
/gate/physics/processes/Bremsstrahlung/setModel StandardModel e+

#/gate/physics/addProcess PositronAnnihilation

/gate/physics/addProcess eMultipleScattering e+
/gate/physics/addProcess eMultipleScattering e-

#/gate/physics/addProcess RadioactiveDecay

/gate/physics/processList Enabled
/gate/physics/processList Initialized


#/gate/actor/addActor PhaseSpaceActor MyActor
#/gate/actor/MyActor/save MyOutputFile.root
#/gate/actor/MyActor/attachTo crystal
#/gate/actor/MyActor/enableProductionProcess false
##/gate/actor/MyActor/enableDirection false
##/gate/actor/MyActor/useVolumeFrame crystal
#/gate/actor/MyActor/storeOutgoingParticles true #To store particles exiting the volume


#=====================================================
# INITIALISATION
#=====================================================

/gate/run/initialize


#===============================================================
# Optical photons Detection Surface should be DIELECTRIC-METAL
#===============================================================

/gate/crystal/surfaces/name                           	surface1
/gate/crystal/surfaces/insert                         	OpticalSystem
/gate/crystal/surfaces/surface1/setSurface  		    rough_teflon_wrapped 

/gate/OpticalSystem/surfaces/name                     	surface2
/gate/OpticalSystem/surfaces/insert                   	crystal
/gate/OpticalSystem/surfaces/surface2/setSurface		rough_teflon_wrapped 

/gate/crystal/surfaces/name                           	Detection1
/gate/crystal/surfaces/insert                         	pixel
/gate/crystal/surfaces/Detection1/setSurface      		perfect_apd 	  

/gate/pixel/surfaces/name                 				Detection2
/gate/pixel/surfaces/insert                   			crystal
/gate/pixel/surfaces/Detection2/setSurface   			perfect_apd   

#=====================================================
#   D I G I T I Z E R: DETECTOR ELECTRONIC RESPONSE
#===================================================== 


/gate/digitizer/Singles/insert 						opticaladder 
/gate/digitizer/Singles/insert                      readout 

/gate/digitizer/Singles/readout/setDepth   1

#/gate/digitizer/Singles/insert upholder
#/gate/digitizer/Singles/upholder/setUphold 8.0 eV


#=====================================================
#  S O U R C E
#=====================================================

/control/execute ./Source.mac

#=====================================================
#  D A T A   O U T P U T   
#=====================================================

/gate/output/ascii/enable
/gate/output/ascii/setFileName opticalTest
/gate/output/ascii/setOutFileHitsFlag 1

/gate/output/root/enable
/gate/output/root/setFileName             hits
/gate/output/root/setRootHitFlag          1
/gate/output/root/setRootSinglesFlag      1
/gate/output/root/setRootOpticalFlag      1

/gate/output/analysis/enable
/gate/output/fastanalysis/enable

#/control/execute                        ./macro/Projection.mac
#=====================================================
#   R A N D O M
#=====================================================

# Choose between: JamesRandom Ranlux64 MersenneTwister
/gate/random/setEngineName MersenneTwister
#/gate/random/setEngineSeed default
/gate/random/setEngineSeed auto
#/gate/random/setEngineSeed 123456789
/gate/random/verbose 0


# A C Q U I S I T I O N


# If using DAQ: setActivity is needed in the Source
/control/execute                        ./StartPrimaries.mac


